// Grant CesiumJS access to your ion assets
Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjMDA4ODc3YS0xOTM1LTRmYjYtYTU4Zi0xMzVhMWE3YTBmMjciLCJpZCI6MzMxODY5LCJpYXQiOjE3NTUxNDU0MTR9.lyGX8350fiq9RExknVy_9hssLUMsNMEERYftpQsVzjw";

// Define the viewer
const viewer = new Cesium.Viewer("cesiumContainer");

// Set terrain provider as Cesium World Terrain using ion asset id 1
viewer.scene.setTerrain(
  new Cesium.Terrain(
    Cesium.CesiumTerrainProvider.fromIonAssetId(1),
  ),
);
viewer.scene.globe.depthTestAgainstTerrain = true;

// --- Google Photorealistic 3D Tiles (for realistic buildings/trees) ---
try {
  const google3dTiles = await Cesium.Cesium3DTileset.fromIonAssetId(2275202);
  viewer.scene.primitives.add(google3dTiles);
} catch (error) {
  console.log("Photorealistic 3D Tiles error:", error);
}

// --- Lilydale to Warburton Rail Trail (thick white line, clamped) ---
try {
  const railTrailRes = await Cesium.IonResource.fromAssetId(3676196);
  const railTrailSource = await Cesium.GeoJsonDataSource.load(railTrailRes, {
    clampToGround: true
  });
  await viewer.dataSources.add(railTrailSource);

  railTrailSource.entities.values.forEach(entity => {
    if (entity.polyline) {
      entity.polyline.width = 6; // thick
      entity.polyline.material = Cesium.Color.WHITE;
      entity.polyline.clampToGround = true; // ensure on terrain
    }
  });

  await viewer.zoomTo(railTrailSource); // focus the scene on the trail
} catch (error) {
  console.log("Rail Trail load error:", error);
}

// --- Waypoints styled by 'Name' (PointGraphics) ---
try {
  const waypointsRes = await Cesium.IonResource.fromAssetId(3676193);
  const waypointsSource = await Cesium.GeoJsonDataSource.load(waypointsRes, {
    clampToGround: true
  });
  await viewer.dataSources.add(waypointsSource);

  waypointsSource.entities.values.forEach(entity => {
    const nameProp = entity.properties && entity.properties.Name;
    const name = nameProp ? String(nameProp.getValue()) : "";

    // Category â†’ color mapping
    let color = Cesium.Color.YELLOW;              // default
    if (/car ?park/i.test(name))               color = Cesium.Color.GRAY;       // Car park
    else if (/toilet/i.test(name))             color = Cesium.Color.BLUE;       // Toilet
    else if (/picnic( table)?s?/i.test(name))  color = Cesium.Color.GREEN;      // Picnic tables
    else if (/bbq|barbecue/i.test(name))       color = Cesium.Color.ORANGERED;  // BBQ
    else if (/drinking water|water/i.test(name)) color = Cesium.Color.CYAN;     // Drinking water
    else if (/lookout|view/i.test(name))       color = Cesium.Color.PURPLE;     // Lookout/View

    entity.point = new Cesium.PointGraphics({
      pixelSize: 10,
      color: color,
      outlineColor: Cesium.Color.WHITE,
      outlineWidth: 1
    });
  });

} catch (error) {
  console.log("Waypoints load error:", error);
}
